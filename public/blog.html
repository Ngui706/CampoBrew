<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>The Journal | TechSips</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>â˜•</text></svg>">
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="data:,">
   
    <script>
        tailwind.config = { 
            theme: { 
                extend: { 
                    colors: { 
                        coffee: { light: '#F5EBE0', DEFAULT: '#D5BDAF', medium: '#C38E70', dark: '#3A2618' } 
                    }, 
                    fontFamily: { sans: ['Poppins'], serif: ['Playfair Display'] } 
                } 
            } 
        }
    </script>
</head>
<body class="bg-coffee-light text-coffee-dark font-sans flex flex-col min-h-screen">

    <nav class="bg-white shadow-md p-4 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <a href="index.html" class="text-2xl font-bold font-serif text-coffee-dark">
                <i class="fa-solid fa-mug-hot text-coffee-medium mr-2"></i>TechSips
            </a>
            <div class="hidden md:flex space-x-8">
                <a href="index.html" class="text-gray-600 hover:text-coffee-medium transition">Home</a>
                <a href="blog.html" class="text-coffee-medium font-medium border-b-2 border-coffee-medium">Blog</a>
                <a href="contact.html" class="text-gray-600 hover:text-coffee-medium transition">Contact</a>
            </div>
        </div>
    </nav>

    <main class="flex-grow max-w-7xl mx-auto px-4 py-16 w-full">
        <h1 class="text-4xl font-serif font-bold mb-2 text-center">The Roaster's Journal</h1>
        <p class="text-center text-gray-500 mb-12">Brewing guides, farm updates, and coffee culture.</p>

        <div id="blog-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 items-start">
            <p class="text-center col-span-full text-gray-500 animate-pulse">Loading latest stories...</p>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const grid = document.getElementById('blog-grid');
            try {
                const response = await fetch(`${API_URL}/blogs`);
                const blogs = await response.json();
                
                if(blogs.length === 0) {
                    grid.innerHTML = '<p class="text-center col-span-full text-gray-500">No journal entries yet. Check back soon!</p>';
                    return;
                }

                // Added an 'index' to uniquely identify each article and button
                grid.innerHTML = blogs.map((blog, index) => `
                    <div class="bg-white rounded-xl shadow-sm overflow-hidden border border-gray-100 flex flex-col transition hover:shadow-md">
                        <div class="p-6 flex-grow">
                            <h2 class="text-xl font-serif font-bold mb-2 text-coffee-dark">${blog.title}</h2>
                            <p class="text-xs text-gray-400 mb-4 uppercase tracking-wider">By ${blog.author} &bull; ${new Date(blog.created_at).toLocaleDateString()}</p>
                            
                            <div id="content-${index}" class="text-gray-600 text-sm line-clamp-4 whitespace-pre-wrap transition-all duration-300">${blog.content}</div>
                        </div>
                        <div class="p-6 pt-0 mt-auto border-t border-gray-50">
                            <button id="btn-${index}" onclick="toggleArticle(${index})" class="text-coffee-medium font-bold text-sm hover:text-coffee-dark mt-4 inline-block transition-colors">
                                Read Article &rarr;
                            </button>
                        </div>
                    </div>
                `).join('');
            } catch (err) {
                grid.innerHTML = '<p class="text-center col-span-full text-red-500">Failed to load the journal.</p>';
            }
        });

        // The logic to expand/collapse the text
        function toggleArticle(index) {
            const contentElement = document.getElementById(`content-${index}`);
            const btnElement = document.getElementById(`btn-${index}`);

            // Check if it's currently clamped (collapsed)
            if (contentElement.classList.contains('line-clamp-4')) {
                // Expand it
                contentElement.classList.remove('line-clamp-4');
                btnElement.innerHTML = '&larr; Read Less';
            } else {
                // Collapse it back
                contentElement.classList.add('line-clamp-4');
                btnElement.innerHTML = 'Read Article &rarr;';
            }
        }
    </script>
</body>
</html>